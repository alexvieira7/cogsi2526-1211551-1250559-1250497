# ============================
# Stage 1 — Build the Spring Boot JAR
# ============================
FROM gradle:8.9-jdk17 AS build

WORKDIR /workspace

# Copy the Gradle project
COPY . .

# Build the fat JAR
RUN ./gradlew bootJar --no-daemon


# ============================
# Stage 2 — Create final minimal image
# ============================
FROM eclipse-temurin:17-jre

WORKDIR /app

# Copy only the JAR from the build stage
COPY --from=build /workspace/build/libs/rest-0.0.1-SNAPSHOT.jar app.jar

EXPOSE 8080

CMD ["java", "-jar", "app.jar"]
